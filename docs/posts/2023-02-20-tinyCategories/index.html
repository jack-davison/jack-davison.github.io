<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.533">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jack Davison">
<meta name="dcterms.date" content="2023-02-20">
<meta name="description" content="Avoiding incomprehensible legend items in your proportion charts through tabulating, lumping or interactive visualisations.">
<title>Visualising Uncommon Factors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
      }
</style>
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="../../site_libs/plotly-binding-4.10.3/plotly.js"></script><script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script><script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.31/datatables.js"></script><link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="../../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="../../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../../site_libs/selectize-0.12.0/selectize.min.js"></script><link rel="stylesheet" href="../../style/styles.css">
<meta property="og:title" content="Visualising Uncommon Factors">
<meta property="og:description" content="Avoiding incomprehensible legend items in your proportion charts through tabulating, lumping or interactive visualisations.">
<meta property="og:image" content="https://jack-davison.github.io/posts/2023-02-20-tinyCategories/banner.jpg">
<meta name="twitter:title" content="Visualising Uncommon Factors">
<meta name="twitter:description" content="Avoiding incomprehensible legend items in your proportion charts through tabulating, lumping or interactive visualisations.">
<meta name="twitter:image" content="https://jack-davison.github.io/posts/2023-02-20-tinyCategories/banner.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jack Davison</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../experience.html"> 
<span class="menu-text">Experience</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jdavison_"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jack-davison"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jack-davison/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Visualising Uncommon Factors</h1>
                  <div>
        <div class="description">
          <p>Avoiding incomprehensible legend items in your proportion charts through tabulating, lumping or interactive visualisations.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">visualisation</div>
                <div class="quarto-category">ggplot2</div>
                <div class="quarto-category">plotly</div>
                <div class="quarto-category">DT</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jack Davison </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 20, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li>
<a href="#strategies" id="toc-strategies" class="nav-link" data-scroll-target="#strategies">Strategies</a>
  <ul class="collapse">
<li><a href="#normalise" id="toc-normalise" class="nav-link" data-scroll-target="#normalise">Normalise</a></li>
  <li><a href="#lump" id="toc-lump" class="nav-link" data-scroll-target="#lump">Lump</a></li>
  <li><a href="#scale-transform" id="toc-scale-transform" class="nav-link" data-scroll-target="#scale-transform">Scale Transform</a></li>
  <li><a href="#zoom" id="toc-zoom" class="nav-link" data-scroll-target="#zoom">Zoom</a></li>
  <li><a href="#interact" id="toc-interact" class="nav-link" data-scroll-target="#interact">Interact</a></li>
  <li><a href="#tabulate" id="toc-tabulate" class="nav-link" data-scroll-target="#tabulate">Tabulate</a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p><img src="banner.jpg" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span> <span class="co"># read rectangular data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span> <span class="co"># data tidying</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># plotting</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="purpose" class="level1"><h1>Purpose</h1>
<p>How often have you seen a “proportion chart” (e.g., a bar chart or pie chart) that looks a little bit like <a href="#fig-default" class="quarto-xref">Figure&nbsp;1</a>?</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">copper</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># read data from online</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://naei.beis.gov.uk/downloads/naei_overview_2023022012422513.csv"</span>,</span>
<span>           skip <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># 'tidy' by putting years in one row</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="st">"Sectors"</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>               names_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">as.integer</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># drop missing values</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make bar chart</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">copper</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Sectors</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Annual UK Copper Emissions (kt)"</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-default" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-default-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-default-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: A typical bar chart. Can you get information from every bar?
</figcaption></figure>
</div>
</div>
</div>
<p>On first glance, you might not think there’s anything wrong with it and, to an extent, there’s not! However, some may argue that some of the legend items here are not overly useful. For example, can you tell me how much copper was emitted from the Transport sector in 2020? You might struggle!</p>
<p>This blog post outlines some ways this data could be presented to make it easier to read, and reveal more of the underlying information than <a href="#fig-default" class="quarto-xref">Figure&nbsp;1</a> does.</p>
</section><section id="strategies" class="level1"><h1>Strategies</h1>
<section id="normalise" class="level2"><h2 class="anchored" data-anchor-id="normalise">Normalise</h2>
<p>One way to overcome the unreadability of some of the smaller categories is to normalise them somehow. For example, we could normalise each of the sectors to their earliest value (in this case, their 1990 value) to have a better feel for the trend. We could have alternatively normalised them to their <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> or <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> values.</p>
<p><strong>Advantage:</strong> All of the sectors are now readable.</p>
<p><strong>Disadvantage:</strong> We’ve lost the “absolute” values and can now only see the trend and “relative” values.</p>
<p><strong>How:</strong> We add an extra <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> step which divides all of the values in each group by their <code><a href="https://dplyr.tidyverse.org/reference/nth.html">first()</a></code> value.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">copper</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">Sectors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Sectors</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Change in Annual UK Copper Emissions,\nNormalised to 1990"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-normalise" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-normalise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-normalise-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-normalise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Each of the sectors have been normalised relative to their first value in 1990.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="lump" class="level2"><h2 class="anchored" data-anchor-id="lump">Lump</h2>
<p>To overcome the disadvantage above (and return to a bar chart) we could use <a href="https://forcats.tidyverse.org/">forcats</a> to “lump” some of the smaller categories together into one “Other” category.</p>
<p><strong>Advantage:</strong> Each of the legend items are now readable and distinct - no more tiny little bars that can’t be discerned right at the bottom. Absolute values are shown.</p>
<p><strong>Disadvantage:</strong> Not all of the sectors have a legend item now. Some readers may skip the caption or body text and not acknowledge what “Other” is composed of. We’ve also lost the specific values for the individual “Other” sectors (not that they could really be read before!)</p>
<p><strong>How:</strong> We can use a function from the <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">forcats::fct_lump()</a></code> family to “lump” together the smaller sectors. In this case we use <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">forcats::fct_lump_lowfreq()</a></code>, which makes sure the “Other” category is always the smallest one. Optionally, we can extract the sectors that make up “Other” and list them in the plot caption (or the body of our report).</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">copper2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">copper</span>,</span>
<span>         sector_lumped <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_lowfreq</a></span><span class="op">(</span><span class="va">Sectors</span>, w <span class="op">=</span> <span class="va">value</span>, other_level <span class="op">=</span> <span class="st">"Other*"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">other_cats</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">copper2</span>, <span class="va">sector_lumped</span> <span class="op">==</span> <span class="st">"Other*"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Sectors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">copper2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sector_lumped</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Annual UK Copper Emissions (kt)"</span>,</span>
<span>       fill <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="va">other_cats</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lump" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-lump-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-lump-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lump-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Lumping the small categories makes the plot easier to read, but we’ve lost the individual values from the ‘Other’ sectors.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="scale-transform" class="level2"><h2 class="anchored" data-anchor-id="scale-transform">Scale Transform</h2>
<p>If we want a bar chart <em>and</em> to retain all the individual sectors, we could choose to use a scale transform. A common scale transform is the log-transform, but there are plenty out there. For example, we could use a square-root axis.</p>
<p><strong>Advantage:</strong> Each of the individual sectors are now visually distinct from one another.</p>
<p><strong>Disadvantage:</strong> Scale transformed axes are harder to read. Many people aren’t familiar with the concept at all - though some would question <a href="https://twitter.com/jburnmurdoch/status/1519215039491756034">if that always really matters</a>.</p>
<p><strong>How:</strong> <a href="https://ggplot2.tidyverse.org">ggplot2</a> makes it easy to transform scales. All of the continuous <code>scales_*_*()</code> functions have the “trans” argument which can transform the axes however we like. There are even short-cuts for the <code>x</code> and <code>y</code> axes, like <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_sqrt()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">copper</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Sectors</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Annual UK Copper Emissions (kt)"</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_sqrt</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-scaletrans" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-scaletrans-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-scaletrans-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scaletrans-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The y-axis is now on a transformed scale; all the categories stand out, but it isn’t necessarily easy to read.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="zoom" class="level2"><h2 class="anchored" data-anchor-id="zoom">Zoom</h2>
<p>If we’re happy using a <a href="https://ggplot2.tidyverse.org">ggplot2</a> extension package, <a href="https://ggforce.data-imaginist.com">ggforce</a> allows us a different way to display smaller values. We could “zoom in” on specific parts of our chart, making it much easier to view those smaller bars in our stacked barchart.</p>
<p><strong>Advantage:</strong> “Best of both worlds” - we get our original plot as well as a version from which readers can see the smaller categories.</p>
<p><strong>Disadvantage:</strong> The plot is now nearly twice as big. We must also now make sure that readers are clear what each panel represents to avoid confusion.</p>
<p><strong>How:</strong> The <code><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html">ggforce::facet_zoom()</a></code> function is a special faceting function which is designed to do exactly what we’re after here.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">copper</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Sectors</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Annual UK Copper Emissions (kt)"</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html">facet_zoom</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span> <span class="op">&lt;=</span> <span class="fl">0.02</span>,</span>
<span>                      zoom.size <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>                      show.area <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-zoom" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-zoom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-zoom-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zoom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Zooming in on a specific part of the plot lets us have the best of both worlds!
</figcaption></figure>
</div>
</div>
</div>
</section><section id="interact" class="level2"><h2 class="anchored" data-anchor-id="interact">Interact</h2>
<p>If we’re in the position to do so, we could create an interactive plot.</p>
<p><strong>Advantage:</strong> Smaller sectors can now be read by turning off the bigger ones, or “zooming in” on the plot. Tooltips can also reveal the precise value of each sector when the reader hovers over the corresponding bar.</p>
<p><strong>Disadvantage:</strong> Restricted to HTML; cannot be inserted into an academic article or powerpoint presentation. Needs an amount of explanation so readers are aware that they can interact with the figure.</p>
<p><strong>How:</strong> There are plenty of different ways to create interactive plots in R, including <a href="https://plotly-r.com">plotly</a>, <a href="https://github.com/rstudio/dygraphs">dygraphs</a> and <a href="https://davidgohel.github.io/ggiraph/">ggiraph</a>. Below a <a href="https://plotly-r.com">plotly</a> graphic is shown.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">copper</span>, colors <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_bars</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">year</span>,</span>
<span>           y <span class="op">=</span> <span class="op">~</span> <span class="va">value</span>,</span>
<span>           color <span class="op">=</span> <span class="op">~</span> <span class="va">Sectors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">layout</span><span class="op">(</span></span>
<span>    barmode <span class="op">=</span> <span class="st">"stack"</span>,</span>
<span>    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Annual UK Copper Emissions (kt)"</span><span class="op">)</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>orientation <span class="op">=</span> <span class="st">'h'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-plotly" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-plotly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3ce0b941022b26a52d13" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3ce0b941022b26a52d13">{"x":{"visdat":{"305457512bb0":["function () ","plotlyVisDat"]},"cur_data":"305457512bb0","attrs":{"305457512bb0":{"colors":"Dark2","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"bar","color":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"barmode":"stack","yaxis":{"domain":[0,1],"automargin":true,"title":"Annual UK Copper Emissions (kt)"},"legend":{"orientation":"h"},"xaxis":{"domain":[0,1],"automargin":true,"title":"year"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.245905902489295,0.247407457118729,0.245999945800942,0.24657904312437201,0.25120568510341701,0.25578695918615302,0.26140543382067799,0.265936818026412,0.27083193858048099,0.27557989736275901,0.27524807926720302,0.27743452317127998,0.28324673609081102,0.28615144111332003,0.289812061151139,0.28914253116338701,0.29244624838619598,0.29539640745382101,0.29096875261117899,0.285335939898056,0.28430190779940301,0.28454878855607102,0.28389629265633398,0.28683455023702098,0.29634712471400698,0.30297198119181101,0.30965417072068002,0.31555393884456301,0.319233479567054,0.32459368350046902,0.26645640202167398],"type":"bar","name":"Automobile tyre and brake wear","marker":{"color":"rgba(27,158,119,1)","line":{"color":"rgba(27,158,119,1)"}},"textfont":{"color":"rgba(27,158,119,1)"},"error_y":{"color":"rgba(27,158,119,1)"},"error_x":{"color":"rgba(27,158,119,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.262108021684473,0.25398263586733,0.25181136873987398,0.25324571928520601,0.25894197286383902,0.26396243535367803,0.270611409297837,0.27519526756026502,0.27557391839513201,0.27900924689694001,0.27414127186673098,0.271331580318318,0.27885549461629899,0.28275779054211497,0.28387649126081799,0.28101032688747302,0.28437499789890103,0.28495914120639698,0.27783855078649899,0.272194124496145,0.27183371750990398,0.27815774302917301,0.27367386206674699,0.27590015081638503,0.285190532012289,0.29063539549353801,0.29544200059664999,0.30224234416114198,0.30474831868462199,0.30971950284673799,0.24267192505614599],"type":"bar","name":"Production Processes","marker":{"color":"rgba(217,95,2,1)","line":{"color":"rgba(217,95,2,1)"}},"textfont":{"color":"rgba(217,95,2,1)"},"error_y":{"color":"rgba(217,95,2,1)"},"error_x":{"color":"rgba(217,95,2,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.050810394486388799,0.050697033896316301,0.0481657757344588,0.041696662911687603,0.037854032876878399,0.030821191795493801,0.0289150906832473,0.0234066975606117,0.0255109886863161,0.020060321269114102,0.020189969106278099,0.015645392413279099,0.0087180039998326995,0.0101875440935464,0.0096968096941098102,0.0084040581958617702,0.0077724883008052402,0.00669759349371563,0.0112265155974999,0.0062769312329967204,0.0065954121340054796,0.0058325017208914597,0.0066778875650284697,0.0065456724631067402,0.0062654002734810798,0.0055086889445902804,0.0048611632036666902,0.0047148773408286796,0.0051230732187310304,0.0044883065992953599,0.0040922359274314498],"type":"bar","name":"Public Electricity Production / Industrial Combustion","marker":{"color":"rgba(117,112,179,1)","line":{"color":"rgba(117,112,179,1)"}},"textfont":{"color":"rgba(117,112,179,1)"},"error_y":{"color":"rgba(117,112,179,1)"},"error_x":{"color":"rgba(117,112,179,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.0100971248541879,0.0096821062802196801,0.0083691688641405592,0.00774538145777797,0.0064583044901226801,0.0050679931193480096,0.0050826822517626496,0.0049723894321772096,0.0041185918129023197,0.0040546188999115501,0.00313013115607865,0.00308341875339607,0.0022437976216629898,0.0020186065925916399,0.0019102987196448599,0.0019864176312508401,0.0018359339786331501,0.0017635378445673699,0.00182178903896369,0.00195947952432559,0.0018399381371158299,0.0017897925296043601,0.0017124561145984299,0.0017842402824196401,0.0017880905082287299,0.00112698250067888,0.0011580921153990099,0.00117923443295718,0.0012032705208465399,0.0011205163006522099,0.0010648190552748199],"type":"bar","name":"Residential / Commercial / Institutional","marker":{"color":"rgba(231,41,138,1)","line":{"color":"rgba(231,41,138,1)"}},"textfont":{"color":"rgba(231,41,138,1)"},"error_y":{"color":"rgba(231,41,138,1)"},"error_x":{"color":"rgba(231,41,138,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.0060356777800898596,0.0059254857606469702,0.0060190169330550701,0.0060343174576071197,0.0064359845767531397,0.0066440431663727702,0.0068415373075890497,0.0070122762202207397,0.0073010243449284301,0.0076394260071153798,0.0075579242041908697,0.0074489409781941397,0.0074193997182392304,0.0075320098272336601,0.0078425383845401892,0.0080566354504203793,0.0079876965235376792,0.0081671651787187903,0.0079016469934669997,0.0073951604235960701,0.0070361719511148604,0.0070603291497317502,0.0068724283763232702,0.0067790756704418503,0.0069157543495712596,0.0069947348316661403,0.0072704784692580599,0.0074127181386332598,0.0074721196009533003,0.0075175407592681298,0.00400996379341019],"type":"bar","name":"Transport","marker":{"color":"rgba(102,166,30,1)","line":{"color":"rgba(102,166,30,1)"}},"textfont":{"color":"rgba(102,166,30,1)"},"error_y":{"color":"rgba(102,166,30,1)"},"error_x":{"color":"rgba(102,166,30,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],"y":[0.0064049365146842396,0.0063733319205711101,0.0063408990063824203,0.0063140491479917503,0.00637884352155262,0.0059558254132491698,0.0061935692662522801,0.0055629405589607802,0.0059546675946210801,0.0059369990908767697,0.0059042688632642403,0.00591113930978702,0.0058753889103950298,0.0058908813275806498,0.0059135435952505202,0.0059340471811295302,0.0059175258537068603,0.0058925009076417796,0.0058045215201378399,0.0058542483336908998,0.0059650869685451803,0.0060152415759074096,0.0059940533277657798,0.0058384680364714598,0.0058274133027739301,0.0056764867427721698,0.0058235770901765701,0.0055778541619655201,0.0054318831028396398,0.0054340785304167298,0.0052253380883902599],"type":"bar","name":"Waste Incineration / Fireworks","marker":{"color":"rgba(230,171,2,1)","line":{"color":"rgba(230,171,2,1)"}},"textfont":{"color":"rgba(230,171,2,1)"},"error_y":{"color":"rgba(230,171,2,1)"},"error_x":{"color":"rgba(230,171,2,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: An interactive plot. Try clicking on the legend or dragging around the plot area.
</figcaption></figure>
</div>
</div>
</section><section id="tabulate" class="level2"><h2 class="anchored" data-anchor-id="tabulate">Tabulate</h2>
<p>A left-field alternative to everything we’ve done so far is to abandon creating a chart altogether and just tabulate our data! In a table, each value takes up the exact same amount of space, so there’s no such thing as a sector too small to really make out.</p>
<p><strong>Advantage:</strong> Every single value can be read. With an interactive table the data is even searchable.</p>
<p><strong>Disadvantage:</strong> It’s not a chart any more. It is also much harder to tell a story with a table like this (e.g., the trend is much harder to identify with a list of numbers).</p>
<p><strong>How:</strong> There are <em>a lot</em> of table packages in R, such as <a href="https://gt.rstudio.com">gt</a>, <a href="https://glin.github.io/reactable/">reactable</a> and <a href="https://github.com/rstudio/DT">DT</a>. Here we use <a href="https://github.com/rstudio/DT">DT</a> to create an interactive, searchable table.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">copper</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Sectors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Sectors</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="cn">FALSE</span>, filter <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html">formatSignif</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">3</span>, digits <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-table" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5f11d506532b17eb15d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5f11d506532b17eb15d0">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Automobile tyre and brake wear&quot;,&quot;Production Processes&quot;,&quot;Public Electricity Production / Industrial Combustion&quot;,&quot;Residential / Commercial / Institutional&quot;,&quot;Transport&quot;,&quot;Waste Incineration / Fireworks&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1990\" data-max=\"2020\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.001064819055274\" data-max=\"0.324593683500469\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Automobile tyre and brake wear","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Production Processes","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Public Electricity Production / Industrial Combustion","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Residential / Commercial / Institutional","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks","Waste Incineration / Fireworks"],[1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020],[0.245905902489295,0.247407457118729,0.245999945800942,0.246579043124372,0.251205685103417,0.255786959186153,0.261405433820678,0.265936818026412,0.270831938580481,0.275579897362759,0.275248079267203,0.27743452317128,0.283246736090811,0.28615144111332,0.289812061151139,0.289142531163387,0.292446248386196,0.295396407453821,0.290968752611179,0.285335939898056,0.284301907799403,0.284548788556071,0.283896292656334,0.286834550237021,0.296347124714007,0.302971981191811,0.30965417072068,0.315553938844563,0.319233479567054,0.324593683500469,0.266456402021674,0.262108021684473,0.25398263586733,0.251811368739874,0.253245719285206,0.258941972863839,0.263962435353678,0.270611409297837,0.275195267560265,0.275573918395132,0.27900924689694,0.274141271866731,0.271331580318318,0.278855494616299,0.282757790542115,0.283876491260818,0.281010326887473,0.284374997898901,0.284959141206397,0.277838550786499,0.272194124496145,0.271833717509904,0.278157743029173,0.273673862066747,0.275900150816385,0.285190532012289,0.290635395493538,0.29544200059665,0.302242344161142,0.304748318684622,0.309719502846738,0.242671925056146,0.0508103944863888,0.0506970338963163,0.0481657757344588,0.0416966629116876,0.0378540328768784,0.0308211917954938,0.0289150906832473,0.0234066975606117,0.0255109886863161,0.0200603212691141,0.0201899691062781,0.0156453924132791,0.008718003999832699,0.0101875440935464,0.00969680969410981,0.00840405819586177,0.00777248830080524,0.00669759349371563,0.0112265155974999,0.00627693123299672,0.00659541213400548,0.00583250172089146,0.00667788756502847,0.00654567246310674,0.00626540027348108,0.00550868894459028,0.00486116320366669,0.00471487734082868,0.00512307321873103,0.00448830659929536,0.00409223592743145,0.0100971248541879,0.00968210628021968,0.008369168864140559,0.00774538145777797,0.00645830449012268,0.00506799311934801,0.00508268225176265,0.00497238943217721,0.00411859181290232,0.00405461889991155,0.00313013115607865,0.00308341875339607,0.00224379762166299,0.00201860659259164,0.00191029871964486,0.00198641763125084,0.00183593397863315,0.00176353784456737,0.00182178903896369,0.00195947952432559,0.00183993813711583,0.00178979252960436,0.00171245611459843,0.00178424028241964,0.00178809050822873,0.00112698250067888,0.00115809211539901,0.00117923443295718,0.00120327052084654,0.00112051630065221,0.00106481905527482,0.00603567778008986,0.00592548576064697,0.00601901693305507,0.00603431745760712,0.00643598457675314,0.00664404316637277,0.00684153730758905,0.00701227622022074,0.00730102434492843,0.00763942600711538,0.00755792420419087,0.00744894097819414,0.00741939971823923,0.00753200982723366,0.007842538384540189,0.008056635450420379,0.007987696523537679,0.00816716517871879,0.007901646993467,0.00739516042359607,0.00703617195111486,0.00706032914973175,0.00687242837632327,0.00677907567044185,0.00691575434957126,0.00699473483166614,0.00727047846925806,0.00741271813863326,0.0074721196009533,0.00751754075926813,0.00400996379341019,0.00640493651468424,0.00637333192057111,0.00634089900638242,0.00631404914799175,0.00637884352155262,0.00595582541324917,0.00619356926625228,0.00556294055896078,0.00595466759462108,0.00593699909087677,0.00590426886326424,0.00591113930978702,0.00587538891039503,0.00589088132758065,0.00591354359525052,0.00593404718112953,0.00591752585370686,0.00589250090764178,0.00580452152013784,0.0058542483336909,0.00596508696854518,0.00601524157590741,0.00599405332776578,0.00583846803647146,0.00582741330277393,0.00567648674277217,0.00582357709017657,0.00557785416196552,0.00543188310283964,0.00543407853041673,0.00522533808839026]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Sectors<\/th>\n      <th>year<\/th>\n      <th>value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 5, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2]},{"name":"Sectors","targets":0},{"name":"year","targets":1},{"name":"value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: This isn’t a plot any more, but it does the job!
</figcaption></figure>
</div>
</div>
</section></section><section id="conclusion" class="level1"><h1>Conclusion</h1>
<p>In this post, I’ve briefly provided several different approaches for handling the situation where one or more categories in your bar chart (or similar chart showing proportion) are too small to make out. Hopefully you’ve learned some new approaches for visualising data like this, and can see there’s not necessarily a “silver bullet” approach that’ll tick every box!</p>
<p>Are there any techniques you use that I’ve missed out? If so, let me know on <a href="https://twitter.com/JDavison_">Twitter</a>!</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span>Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><img src="../../style/logo.png" style="width:7.5%"></p>
</div>
    <div class="nav-footer-right">
<p><span><a href="https://github.com/jack-davison/jack-davison.github.io">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>