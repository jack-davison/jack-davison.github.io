<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jack Davison">
<meta name="dcterms.date" content="2021-02-02">
<meta name="description" content="A disucssion on data tidying and cleaning, with applications to a messy, unfamiliar data set.">
<title>An Ode to Data Tidying (TidyTuesday 2021 Week 6: HBCU Enrolment)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="An Ode to Data Tidying (TidyTuesday 2021 Week 6: HBCU Enrolment)">
<meta property="og:description" content="A disucssion on data tidying and cleaning, with applications to a messy, unfamiliar data set.">
<meta property="og:image" content="https://jack-davison.github.io/posts/2021-02-02-tidytuesday-2021-week-6-hbcu-enrollment-an-ode-to-data-cleaning/students.jpg">
<meta name="twitter:title" content="An Ode to Data Tidying (TidyTuesday 2021 Week 6: HBCU Enrolment)">
<meta name="twitter:description" content="A disucssion on data tidying and cleaning, with applications to a messy, unfamiliar data set.">
<meta name="twitter:image" content="https://jack-davison.github.io/posts/2021-02-02-tidytuesday-2021-week-6-hbcu-enrollment-an-ode-to-data-cleaning/students.jgp">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.png" alt="" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../experience.html" rel="" target="">
 <span class="menu-text">Experience</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html" rel="" target="">
 <span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jdavison_" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jack-davison" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jack-davison/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">An Ode to Data Tidying (TidyTuesday 2021 Week 6: HBCU Enrolment)</h1>
                  <div>
        <div class="description">
          <p>A disucssion on data tidying and cleaning, with applications to a messy, unfamiliar data set.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">tidytuesday</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jack Davison </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 2, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction-or-what-do-we-mean-by-tidy" id="toc-introduction-or-what-do-we-mean-by-tidy" class="nav-link active" data-scroll-target="#introduction-or-what-do-we-mean-by-tidy">Introduction (or, “What do we mean by Tidy?”)</a></li>
  <li>
<a href="#the-hbcu-data" id="toc-the-hbcu-data" class="nav-link" data-scroll-target="#the-hbcu-data">The HBCU Data</a>
  <ul class="collapse">
<li><a href="#what-are-the-issues" id="toc-what-are-the-issues" class="nav-link" data-scroll-target="#what-are-the-issues">What are the issues?</a></li>
  <li><a href="#cleaning-and-tidying" id="toc-cleaning-and-tidying" class="nav-link" data-scroll-target="#cleaning-and-tidying">Cleaning and Tidying</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data Analysis</a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p><img src="students.jpg" class="img-fluid"></p>
<section id="introduction-or-what-do-we-mean-by-tidy" class="level1"><h1>Introduction (or, “What do we mean by Tidy?”)</h1>
<p>This week’s TidyTuesday is related to HBCU Enrolment. I will have to start by admitting my ignorance - I had no real idea what “HBCU” actually meant, which I attribute to being from the UK. However, datasets on American culture or politics that I’m not very familiar with has never stopped me before! So I sat down to give it a look. To my horror - or, perhaps, delight - the dataset was not particularly tidy. I will admit, there is something delightful about tackling a particularly untidy data set and turning it into something beautiful and easy to work with.</p>
<p>What do I mean by <em>tidy data</em>? The <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidyr vingette</a> defines it as follows:</p>
<blockquote class="blockquote">
<p>Each variable forms a column. Each observation forms a row. Each type of observational unit forms a table.</p>
</blockquote>
<p>A <em>variable</em> contains all values that measure some unique feature - height, weight, length, temperature. An <em>observation</em> ties together the different values into one observational unit - a date, an object, a person. For the sake of example, say we have a data set of secondary school children who have all sat their end of year exams in several subjects that are all scored out of 100. We may be tempted to lay the data out in a <em>wide</em> format, as I have below:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">student</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">english</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">maths</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">science</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Amy</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">Barry</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colin</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">64</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>However, is this <em>tidy</em>? Our <em>observations</em> are the students, yes, but our <em>variables</em> are not <strong>student</strong>, <strong>maths</strong>, <strong>english</strong> and <strong>history</strong>. The “real” variables should be <strong>student</strong>, <strong>subject</strong> and <strong>mark</strong>.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">student</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mark</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Amy</td>
<td style="text-align: left;">english</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amy</td>
<td style="text-align: left;">maths</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amy</td>
<td style="text-align: left;">science</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">Barry</td>
<td style="text-align: left;">english</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Barry</td>
<td style="text-align: left;">maths</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">Barry</td>
<td style="text-align: left;">science</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colin</td>
<td style="text-align: left;">english</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colin</td>
<td style="text-align: left;">maths</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colin</td>
<td style="text-align: left;">science</td>
<td style="text-align: right;">64</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are benefits to having data in this format. For example, we could <code>group_by()</code> the subject and <code>summarise()</code> a mean and standard deviation. We could <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> for the students who scored less than 50 in a subject who may need extra help. If we had another data set of the subject teachers and the students they teach, we could <code>left_join()</code> these on to see which teachers are helping the students to score the top marks. All of this would be much, much more difficult in the <em>wide</em> format we had the data in before.</p>
<p>Note that there are some situations where we might want the data <em>wide</em> - for example, what if we wanted to plot english marks vs maths marks? Or perhaps perform correlations between all of the different subjects? In the former case we can easily <code>pivot_wider()</code> just for this job. In the latter case we could also <code>pivot_wider()</code>, but there is also the <code>widyr</code> package that can just do it from a <em>tidy</em> format anyway!</p>
</section><section id="the-hbcu-data" class="level1"><h1>The HBCU Data</h1>
<section id="what-are-the-issues" class="level2"><h2 class="anchored" data-anchor-id="what-are-the-issues">What are the issues?</h2>
<p>Let’s read in the data and give it a look over.</p>
<p>The <code>bach_students</code> data set indicates…</p>
<blockquote class="blockquote">
<p>The percentage of students broken down by race/ethnicity, aged 25 and over who have attained a bachelor’s degree.</p>
</blockquote>
<p>But in the form it is in, it is pretty <em>untidy</em> and <em>unclean</em>. Here are some issues I can identify:</p>
<ul>
<li>Our key variables are effectively <strong>year</strong>, <strong>race</strong>, <strong>total</strong> and <strong>standard error</strong>, but <strong>race</strong> is spread over multiple columns (remember - each column should represent a variable, not multiple columns representing one variable).</li>
<li>All of the columns should be numbers, but they have read in as characters.</li>
<li><strong>Asian people and Pacific Islanders are given twice - as a total of the two and individually.</strong></li>
<li>The names of the columns have spaces in them, are wordy and therefore generally difficult to use.</li>
<li>The <code>Total</code> column represents the year. The name is therefore a bit misleading.</li>
</ul>
<p>A note on the emboldened item above; in my experience, data “in the wild” that has been put together in Excel typically has baggage like this as spreadsheets are sadly used for both data storage <em>and</em> presentation. This means that totals and the like are given alongside the data used to calculate them. I don’t feel bad about removing data like this <strong>as long as we are left with the tools to recalculate them</strong>. In this case, we are! If we want to regroup the Asian/Pacific Islander data it’d be as easy as renaming them both as the same thing using <code>mutate()</code> and <code>if_else()</code>, and then <code>group_by()</code> and <code>summarise()</code> to re-calculate the total. It may even be that we want to combine more racial groups using a <code>fct_lump()</code> function.</p>
</section><section id="cleaning-and-tidying" class="level2"><h2 class="anchored" data-anchor-id="cleaning-and-tidying">Cleaning and Tidying</h2>
<p>Let’s start by making sure that all of the data is numeric. <code>dplyr v1.0.0</code> gave us the <code>across()</code> function that makes this a breeze.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 19
   Total Total, percent of all persons age 25 an…¹ Standard Errors - To…² White1
   &lt;dbl&gt;                                     &lt;dbl&gt;                  &lt;dbl&gt;  &lt;dbl&gt;
 1  1910                                       2.7                  NA      NA  
 2  1920                                       3.3                  NA      NA  
 3  1930                                       3.9                  NA      NA  
 4  1940                                       4.6                  NA       4.9
 5  1950                                       6.2                  NA       6.6
 6  1960                                       7.7                  NA       8.1
 7  1970                                      11                    NA      11.6
 8  1975                                      13.9                  NA      14.9
 9  1980                                      17                    -0.16   18.4
10  1985                                      19.4                  -0.16   20.8
11  1986                                      19.4                  -0.16   20.9
12  1987                                      19.9                  -0.16   21.4
13  1988                                      20.3                  -0.16   21.8
14  1989                                      21.1                  -0.16   22.8
15  1990                                      21.3                  -0.16   23.1
16  1991                                      21.4                  -0.16   23.3
# ℹ abbreviated names: ¹​`Total, percent of all persons age 25 and over`,
#   ²​`Standard Errors - Total, percent of all persons age 25 and over`
# ℹ 15 more variables: `Standard Errors - White1` &lt;dbl&gt;, Black1 &lt;dbl&gt;,
#   `Standard Errors - Black1` &lt;dbl&gt;, Hispanic &lt;dbl&gt;,
#   `Standard Errors - Hispanic` &lt;dbl&gt;, `Total - Asian/Pacific Islander` &lt;dbl&gt;,
#   `Standard Errors - Total - Asian/Pacific Islander` &lt;dbl&gt;,
#   `Asian/Pacific Islander - Asian` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>We could be tempted now to run <code><a href="https://sfirke.github.io/janitor/reference/clean_names.html">janitor::clean_names()</a></code>. For those unfamiliar, this function cleans the names of a data frame to make them easier to use - all lower-case, spaces replaced with underscores, and the like. Normally it’s a good idea to use it as soon as possible, but as I am going to restructure my data I am not going to use it right away. As <em>race</em> will be one of my columns, I’d probably want words like “White” and “Black” to remain capitalised, so if I reported them in a table or use them in a legend label they’d look more presentable.</p>
<p>Next, we can start restructuring. A good trick with <code>pivot_longer()</code> is that it behaves much the same as functions like <code>select()</code> - if we list a column name preceded with a minus sign (<code>-</code>) it effectively tells the function “everything but this column, please!” I’m not going to specify column names for the names or values here as we’ll quickly get rid of them.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   Total name                                                              value
   &lt;dbl&gt; &lt;chr&gt;                                                             &lt;dbl&gt;
 1  1910 "Total, percent of all persons age 25 and over"                     2.7
 2  1910 "Standard Errors - Total, percent of all persons age 25 and over"  NA  
 3  1910 "White1"                                                           NA  
 4  1910 "Standard Errors - White1"                                         NA  
 5  1910 "Black1"                                                           NA  
 6  1910 "Standard Errors - Black1"                                         NA  
 7  1910 "Hispanic"                                                         NA  
 8  1910 "Standard Errors - Hispanic"                                       NA  
 9  1910 "Total - Asian/Pacific Islander"                                   NA  
10  1910 "Standard Errors - Total - Asian/Pacific Islander"                 NA  
11  1910 "Asian/Pacific Islander - Asian"                                   NA  
12  1910 "Standard Errors - Asian/Pacific Islander - Asian"                 NA  
13  1910 "Asian/Pacific Islander - Pacific Islander"                        NA  
14  1910 "Standard Errors - Asian/Pacific Islander - Pacific Islander"      NA  
15  1910 "American Indian/\r\nAlaska Native"                                NA  
16  1910 "Standard Errors - American Indian/\r\nAlaska Native"              NA  </code></pre>
</div>
</div>
<p>Now we can remove that Asian/Pacific Islander total we spoke about earlier. We will use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> alongside the <code>str_detect()</code> function and the logical operator <code>!</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   Total name                                                              value
   &lt;dbl&gt; &lt;chr&gt;                                                             &lt;dbl&gt;
 1  1910 "Total, percent of all persons age 25 and over"                     2.7
 2  1910 "Standard Errors - Total, percent of all persons age 25 and over"  NA  
 3  1910 "White1"                                                           NA  
 4  1910 "Standard Errors - White1"                                         NA  
 5  1910 "Black1"                                                           NA  
 6  1910 "Standard Errors - Black1"                                         NA  
 7  1910 "Hispanic"                                                         NA  
 8  1910 "Standard Errors - Hispanic"                                       NA  
 9  1910 "Asian/Pacific Islander - Asian"                                   NA  
10  1910 "Standard Errors - Asian/Pacific Islander - Asian"                 NA  
11  1910 "Asian/Pacific Islander - Pacific Islander"                        NA  
12  1910 "Standard Errors - Asian/Pacific Islander - Pacific Islander"      NA  
13  1910 "American Indian/\r\nAlaska Native"                                NA  
14  1910 "Standard Errors - American Indian/\r\nAlaska Native"              NA  
15  1910 "Two or more race"                                                 NA  
16  1910 "Standard Errors - Two or more race"                               NA  </code></pre>
</div>
</div>
<p>To separate the total values from the standard errors we can use the <code>separate()</code> function and the <code>" - "</code> string. Issues once again come from the Asian and Pacific Islander data as they have a second <code>" - "</code> in them, but this can be straightforwardly removed. For whatever reason, “White” and “Black” are listed with the number one (1) after them, so we can get rid of this while we’re on the subject of cleaning strings.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Asian/Pacific Islander - |1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   Total name                                                              value
   &lt;dbl&gt; &lt;chr&gt;                                                             &lt;dbl&gt;
 1  1910 "Total, percent of all persons age 25 and over"                     2.7
 2  1910 "Standard Errors - Total, percent of all persons age 25 and over"  NA  
 3  1910 "White"                                                            NA  
 4  1910 "Standard Errors - White"                                          NA  
 5  1910 "Black"                                                            NA  
 6  1910 "Standard Errors - Black"                                          NA  
 7  1910 "Hispanic"                                                         NA  
 8  1910 "Standard Errors - Hispanic"                                       NA  
 9  1910 "Asian"                                                            NA  
10  1910 "Standard Errors - Asian"                                          NA  
11  1910 "Pacific Islander"                                                 NA  
12  1910 "Standard Errors - Pacific Islander"                               NA  
13  1910 "American Indian/\r\nAlaska Native"                                NA  
14  1910 "Standard Errors - American Indian/\r\nAlaska Native"              NA  
15  1910 "Two or more race"                                                 NA  
16  1910 "Standard Errors - Two or more race"                               NA  </code></pre>
</div>
</div>
<p>Now let’s add that <code>separate()</code> step, which we need to give some column names for the <strong>name</strong> column to turn into, the separating character (space-dash-space), and the direction to fill in (in this case left).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Asian/Pacific Islander - |1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stat"</span>,<span class="st">"race"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" - "</span>, fill <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   Total stat            race                                            value
   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;                                           &lt;dbl&gt;
 1  1910 &lt;NA&gt;            "Total, percent of all persons age 25 and over"   2.7
 2  1910 Standard Errors "Total, percent of all persons age 25 and over"  NA  
 3  1910 &lt;NA&gt;            "White"                                          NA  
 4  1910 Standard Errors "White"                                          NA  
 5  1910 &lt;NA&gt;            "Black"                                          NA  
 6  1910 Standard Errors "Black"                                          NA  
 7  1910 &lt;NA&gt;            "Hispanic"                                       NA  
 8  1910 Standard Errors "Hispanic"                                       NA  
 9  1910 &lt;NA&gt;            "Asian"                                          NA  
10  1910 Standard Errors "Asian"                                          NA  
11  1910 &lt;NA&gt;            "Pacific Islander"                               NA  
12  1910 Standard Errors "Pacific Islander"                               NA  
13  1910 &lt;NA&gt;            "American Indian/\r\nAlaska Native"              NA  
14  1910 Standard Errors "American Indian/\r\nAlaska Native"              NA  
15  1910 &lt;NA&gt;            "Two or more race"                               NA  
16  1910 Standard Errors "Two or more race"                               NA  </code></pre>
</div>
</div>
<p>You’ll notice that in the <strong>stats</strong> column we have some NA values that actually correspond to the “total” stat, so we’ll fill those in using a <code>tidyr</code> function, <code>replace_na()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Asian/Pacific Islander - |1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stat"</span>,<span class="st">"race"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" - "</span>, fill <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>stat <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">stat</span>, <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   Total stat            race                                            value
   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;                                           &lt;dbl&gt;
 1  1910 Total           "Total, percent of all persons age 25 and over"   2.7
 2  1910 Standard Errors "Total, percent of all persons age 25 and over"  NA  
 3  1910 Total           "White"                                          NA  
 4  1910 Standard Errors "White"                                          NA  
 5  1910 Total           "Black"                                          NA  
 6  1910 Standard Errors "Black"                                          NA  
 7  1910 Total           "Hispanic"                                       NA  
 8  1910 Standard Errors "Hispanic"                                       NA  
 9  1910 Total           "Asian"                                          NA  
10  1910 Standard Errors "Asian"                                          NA  
11  1910 Total           "Pacific Islander"                               NA  
12  1910 Standard Errors "Pacific Islander"                               NA  
13  1910 Total           "American Indian/\r\nAlaska Native"              NA  
14  1910 Standard Errors "American Indian/\r\nAlaska Native"              NA  
15  1910 Total           "Two or more race"                               NA  
16  1910 Standard Errors "Two or more race"                               NA  </code></pre>
</div>
</div>
<p>Now we can <code>pivot_wider()</code> to get the total values and the standard errors in their own columns. We’ll have to rename the existing <strong>Total</strong> column first, but that can be achieved using <code>dplyr</code>’s <code>rename()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Asian/Pacific Islander - |1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stat"</span>,<span class="st">"race"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" - "</span>, fill <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>stat <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">stat</span>, <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>year <span class="op">=</span> <span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">stat</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
   year race                                            Total `Standard Errors`
  &lt;dbl&gt; &lt;chr&gt;                                           &lt;dbl&gt;             &lt;dbl&gt;
1  1910 "Total, percent of all persons age 25 and over"   2.7                NA
2  1910 "White"                                          NA                  NA
3  1910 "Black"                                          NA                  NA
4  1910 "Hispanic"                                       NA                  NA
5  1910 "Asian"                                          NA                  NA
6  1910 "Pacific Islander"                               NA                  NA
7  1910 "American Indian/\r\nAlaska Native"              NA                  NA
8  1910 "Two or more race"                               NA                  NA</code></pre>
</div>
</div>
<p>The data is now tidy! We can do some additional cleaning steps now - there seems to be something odd going on with the American Indian/Alaska Native string, and the “Total” string is a bit wordy. Let’s sort that out, and finally throw in that <code>janitor</code> function I talked about right at the beginning.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">=</span> <span class="va">bach_students</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">parse_number</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Total - Asian/Pacific Islander"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"Asian/Pacific Islander - |1"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stat"</span>,<span class="st">"race"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" - "</span>, fill <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>stat <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">stat</span>, <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>year <span class="op">=</span> <span class="va">Total</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">stat</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu">str_remove_all</span><span class="op">(</span></span>
<span>      <span class="va">race</span>, </span>
<span>      <span class="st">", percent of all persons age 25 and over|\r\n"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
   year race                          total standard_errors
  &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt;           &lt;dbl&gt;
1  1910 Total                           2.7              NA
2  1910 White                          NA                NA
3  1910 Black                          NA                NA
4  1910 Hispanic                       NA                NA
5  1910 Asian                          NA                NA
6  1910 Pacific Islander               NA                NA
7  1910 American Indian/Alaska Native  NA                NA
8  1910 Two or more race               NA                NA</code></pre>
</div>
</div>
<p>We did it! The data is now clean and tidy and ready to use. Let’s do a bit of analysis just to demonstrate how straightforward it is to use now.</p>
</section><section id="data-analysis" class="level2"><h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<p>We can create some cool plots now we have access to this data. We can start with a simple timeseries.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">=</span> <span class="va">df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">total</span><span class="op">:</span><span class="va">standard_errors</span>, <span class="op">~</span><span class="va">.x</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">race</span> <span class="op">!=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>race <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">race</span>, <span class="va">total</span>, <span class="va">max</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>         race <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">race</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">total</span>,</span>
<span>    ymax <span class="op">=</span> <span class="va">total</span> <span class="op">+</span> <span class="va">standard_errors</span>,</span>
<span>    ymin <span class="op">=</span> <span class="va">total</span> <span class="op">-</span> <span class="va">standard_errors</span>,</span>
<span>    group <span class="op">=</span> <span class="va">race</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">race</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">race</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="va">race</span> <span class="op">==</span> <span class="st">"Total"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="st">"Race"</span>, fill <span class="op">=</span> <span class="st">"Race"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Bachelor's Degree Attainment"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"The percentage of the population who have achieved a\nbachelor's degree in the US since 1980, split into racial groups.\nThe bold line represents the total population."</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title.position <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Or we could just focus in on the most recent data.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_data_2</span> <span class="op">=</span> <span class="va">plot_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>race <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">race</span>, <span class="va">total</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tot</span> <span class="op">=</span> <span class="va">plot_data_2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">race</span> <span class="op">==</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">total</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data_2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>flag <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">race</span> <span class="op">==</span> <span class="st">"Total"</span> <span class="op">~</span> <span class="st">"T"</span>,</span>
<span>                          <span class="va">total</span> <span class="op">&gt;</span> <span class="va">tot</span> <span class="op">~</span> <span class="st">"Y"</span>,</span>
<span>                          <span class="va">total</span> <span class="op">&lt;</span> <span class="va">tot</span> <span class="op">~</span> <span class="st">"X"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">race</span>, x <span class="op">=</span> <span class="va">total</span>, xmax <span class="op">=</span> <span class="va">total</span><span class="op">+</span><span class="va">standard_errors</span>, xmin <span class="op">=</span> <span class="va">total</span><span class="op">-</span><span class="va">standard_errors</span>, fill <span class="op">=</span> <span class="va">flag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">tot</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"Bachelor's Degree Attainment in 2016"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_data_2</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/remove_constant.html">remove_constant</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span></span>
<span>    <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{abs(.x) * 100} %"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Race"</span>, <span class="st">"Total"</span>, <span class="st">"Std Err."</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Race</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Std Err.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">33.4 %</td>
<td style="text-align: left;">0.24 %</td>
</tr>
<tr class="even">
<td style="text-align: left;">White</td>
<td style="text-align: left;">37.3 %</td>
<td style="text-align: left;">0.31 %</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Black</td>
<td style="text-align: left;">23.5 %</td>
<td style="text-align: left;">0.46 %</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hispanic</td>
<td style="text-align: left;">16.4 %</td>
<td style="text-align: left;">0.4 %</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">56.4 %</td>
<td style="text-align: left;">0.89 %</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pacific Islander</td>
<td style="text-align: left;">27.5 %</td>
<td style="text-align: left;">2.92 %</td>
</tr>
<tr class="odd">
<td style="text-align: left;">American Indian/Alaska Native</td>
<td style="text-align: left;">16.8 %</td>
<td style="text-align: left;">1.39 %</td>
</tr>
<tr class="even">
<td style="text-align: left;">Two or more race</td>
<td style="text-align: left;">30.6 %</td>
<td style="text-align: left;">1.52 %</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>See how easy it is to use this data now? Incredible!</p>
</section></section><section id="conclusion" class="level1"><h1>Conclusion</h1>
<p>In this post we explored the ideas of data tidying and cleaning using a messy, unfamiliar data set. We showed how the <code>tidyverse</code> packages can help us achieve this goal easily and quickly, and demonstrated how easy it is to then go on and perform some basic data analysis on our newly tidied data.</p>
<p>I use this sort of process all the time, especially when data has been ripped from Excel spreadsheets that are trying to store and display data at the same time - a recipe for disaster when it comes to reading into R!</p>
<p>Hopefully this post was interesting for newer R users, and I look forward to the visualisations that will come from this week’s TidyTuesday data sets!</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>